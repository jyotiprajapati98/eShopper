<html>
<head>
    <title>User Dashboard</title>
   
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" >
    <link rel="stylesheet" href="css/mystyle.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.2/axios.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <meta name="google-signin-scope" content="profile email">
    <meta name="google-signin-client_id" content="YOUR_CLIENT_ID.apps.googleusercontent.com">
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <!-- <script src="jquery.min.js"></script>
    <script src="bootstrap.min.js"></script>
    <link href="bootstrap.min.css" rel="stylesheet"> -->

    
    </div>
    <style>
        body {
        font-family: Arial, Helvetica, sans-serif;
        color: black;
      }
      .center{
        margin-top: 20px;
        width: 500px;
        font-family: Arial, Helvetica, sans-serif;
        font-size: 25px;
      }
      input[type=submit] {
        background-color: #0000CC;
        width: 700px;
        border: none;
        border-radius: 5px;
        color: white;
        padding: 6px 16px;
        text-decoration: none;
        margin-top: 20px;
        cursor: pointer;
      }
      input[type=reset]{
        background-color: #FF3300;
        width: 700px;
        border: none;
        border-radius: 5px;
        color: white;
        padding: 6px 16px;
        text-decoration: none;
        margin-top: 10px;
        margin-bottom: 20px; 
        cursor: pointer;
      }
      input[type=text], input[type=number] {
        margin: auto;
        width: 700px;
        height: 35px;
        font-size: 20px;
        border-radius: 5px;    
        border-left-width: 15px;
        border-color: #300108;
      }
        table[id=inner] {
            width:90%;
            background-color: #ffffff;
            padding: 5px 5px;
            border-width: 5px;
            border-color: #660000;
            border-radius: 10px;
  }
        table[id=tabledata] {
            margin-left:20px; 
            margin-top:20px;
            font-size: 20px;

  }
    </style>
    <link rel="stylesheet" href="css/mystyle.css">

  <nav class="navbar navbar-inverse navbar-expand-md bigBar" style=" 
     background-color: #212529">
        <div class="container-fluid">
          <div class="navbar-header">
            <a style="font-size: 18px; color: yellow;" class="navbar" >eShopper</a>
          </div>
          <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
            <li class="nav-item">
                <a style="color: white;" class="nav-link" href="home.html"> Home  </a></li>
           
           </ul>
          <ul class="navbar-nav navbar-right">
            <li class="nav-item">
              <a style="color: white;"  class="nav-link"  href="Cart.html">My Cart</a></li>
             <li class="nav-item">
                <a style="color: white;"  class="nav-link"  href="aboutus.html">About us</a></li>
               
            <script>

                      if(sessionStorage.getItem("user_role")!=null){
                                document.write(' <li class="nav-item"> <a style="color: white;"  class="nav-link"  href="logout.html">Logout</a></li> ');
                              }
                              else{
                                document.write(' <li class="nav-item"><a style="color: white;"  class="nav-link"  href="signup.html">Sign Up</a></li> <li class="nav-item"><a style="color: white;"  class="nav-link" href="login.html">Login</a>');
                      
                              }
                            </script>
            </li>
      
          </ul>
        </div>
      </nav>
 

<body>


 

    <div class="row" style="margin: 20px">
        <div class="leftcolumn" style="width: 25%">
            <div class="card" style="height: 100px; background-color: #0066cc">
                <table><tr>
                    <td><img src="images/person1.jpg" width="90" height="90" style="margin: 5px; border-radius: 100px"></td>
                    <td><h3>Happy Shopping</h3></td>
                </tr></table>
            </div>
            <div class="card"style=" margin-top:10px; height:300px">
               
               <table style="height: 100%">
                   <tr><td><button style="width: 100%; height: 100px; background-color: #669999" id="personal">Personal Info</button></td></tr>
                   <tr><td><button style="width: 100%; height: 100px; background-color: #999966" id="address">Address</button></td></tr>
                   <tr><td><button style="width: 100%; height: 100px; background-color: #669999" id="order">My orders</button></td></tr>
                   <tr><td><button style="width: 100%; height: 100px; background-color: #999966" id="cart">My cart</button></td></tr>
               </table>
               
            </div>
        </div>
        <div class="rightcolumn" style="width: 75%;">
            <div class="card" style="min-height: 610px; margin-left:10px; width: 100%">
                    <div style="background-color: #aaa; padding-bottom: 50px; height: 100%">
                    <table id="tabledata" style="margin-right: 20px; width:95%; "> 
                    
                    <tbody id="tablebody">

                    </tbody>
                    </table>
                  </div>
                    <script>

                        myCart();
                        document.getElementById("personal").onclick = function() {myPersonal()};
                        //document.getElementById("address").onclick = function() {myAddress()};
                        document.getElementById("order").onclick = function() {myOrder()};
                        document.getElementById("cart").onclick = function() {myCart()};

                        function myPersonal() {
                          let uid = sessionStorage.getItem("user_id");
                                const url='http://localhost:3000/users?id='+uid;
                          
                                axios.get(url)
                                .then(resp => {
                                    data = resp.data;
                                    tablebody.innerHTML = createTable(data);
                                })
                                .catch(error => {
                                    console.log(error);
                                });   
                                
                                function createTable(data) {

                                    let table ='<tr><td><h2>Personal Info</h2></td></tr>'
                                    var i=0;
                                    data.map(e => {
                                      table += `<br><br><tr style="background-color:#669999;">
                                                      <td style="padding-left:200px; padding-top:10px; padding-bottom:10px">Name: </td><td style="padding-right:300px; padding-top:10px; padding-bottom:10px"">${e.name}</td> 
                                                    </tr>
                                                <br><br><tr style="background-color:#669999;">
                                                      <td style="padding-left:200px; padding-top:10px; padding-bottom:10px"">Mobile No.: </td><td>${e.mono}</td>
                                                      </tr>
                                                <br><br><tr style="background-color:#669999;">
                                                      <td style="padding-left:200px; padding-top:10px; padding-bottom:10px"">Email: </td><td>${e.email}</td>
                                                      </tr>
                                                <br><br><tr style="background-color:#669999;">
                                                      <td style="padding-left:200px; padding-top:10px; padding-bottom:10px"">Address: </td><td>${e.addr}</td>
                                                      </tr>
                                                <br><br><tr style="background-color:#669999;">
                                                      <td style="padding-left:200px; padding-top:10px; padding-bottom:10px"">District: </td><td>${e.city}</td>
                                                      </tr>
                                                <br><br><tr style="background-color:#669999;">
                                                      <td style="padding-left:200px; padding-top:10px; padding-bottom:10px"">State: </td><td>${e.state}</td>
                                                      </tr>
                                                <br><br><tr style="background-color:#669999;">
                                                      <td style="padding-left:200px; padding-top:10px; padding-bottom:10px"">Pin: </td><td>${e.pin}</td>
                                                      </tr><br>`
                                    })
                                    return table;
                                }
                        }
                        function myAddress() {
                          let uid = sessionStorage.getItem("user_id");
                          
                                const url='http://localhost:3000/users?id='+uid;
                                axios.get(url)
                                .then(resp => {
                                    data = resp.data;
                                    tablebody.innerHTML = createTable(data);
                                })
                                .catch(error => {
                                    console.log(error);
                                });   
                                
                                function createTable(data) {

                                    let table =''
                                   
                                    data.map(e => {
                                      table += `<div style="margin-left:50px">
                                                <tr><td>
                                                <label><h2><b>SHIPPING DETAILS</b><h2></label><br>
                                                <label><b>Name</b></label><br>
                                                <input type="text" id="name" value="${e.name}"><br>
                                                <label><b>Mobile</b></label><br>
                                                <input type="text" id="email" value="${e.email}"><br>
                                                <label><b>Address</b></label><br>
                                                <input type="text" id="addr" value="${e.addr}"><br>
                                                <label><b>City</b></label><br>
                                                <input type="text" id="city" value="${e.city}"><br>
                                                <label><b>State</b></label><br>
                                                <input type="text" id="state" value="${e.state}"><br>
                                                <label><b>Pincode</b></label><br>
                                                <input type="number" id="pin" value="${e.pin}"><br>
                                                <input type="submit" value="PLACE ORDER" style="font-size: 20px" id="placed" onclick="done()">
                                                <input type="reset" value="RESET" style="font-size: 20px">
                                              </td></tr>`
                                   
                                    
                                    })

                                   
                                    return table;
                                }
                        }
                        function myCart() {
                          let uid = sessionStorage.getItem("user_id");
                                const url='http://localhost:3000/cart';
                                axios.get(url)
                                .then(resp => {
                                    data = resp.data;
                                    tablebody.innerHTML = createTable(data);
                                })
                                .catch(error => {
                                    console.log(error);
                                });   
                                
                                function createTable(data) {
                                    let table ='<tr><td><h2>My Cart</h2></td></tr>'
                                    var i=0;
                                    var j=0;
                                    data.map(e => {
                                        if((parseInt(uid))==(parseInt(e.uid))){
                                                table += `<div style="margin:20px; color:black">
                                                          <tr>
                                                            <td style="width:30%; padding-top:10px; padding-bottom:10px; background-color:#999966">
                                                                <center><img src="${e.img}" width="200" height="200"/>
                                                                </center>
                                                            </td>
                                                            <td style="background-color:#999966">
                                                                <center>${e.name}
                                                                </center>
                                                            </td>
                                                            <td style="background-color:#999966">
                                                                <center>Rs. ${e.price}
                                                                </center>
                                                            </td>
                                                            <td style="background-color:#999966">
                                                                <center>${e.description}
                                                                </center>
                                                            </td>
                                                            <td style="background-color:#999966">
                                                                <button style="width:80px; margin-top:20px; margin-bottom:20px; margin-left:50px; width:40%; background-color:#FF3300; border:none; border-radius:5px; padding:10px;" onclick="remove(${e.id})">Remove</button>
                                                                
                                                            </td>
                                                          </tr>
                                                          </div>`
                                        i += parseInt(e.price);
                                        j++;
                                        }
                            
                                    })
                                    table += `<br><tr><td></td><td></td><td></td><td></td><td><center><h3>Total Payable: Rs. ${i}</h3></center></td></tr>`
                                    table += `<tr><td></td><td></td><td></td><td></td><td><button id="checkout" style="margin-top:20px; margin-right:10px; width:98%; background-color:#008000; color:white; border:none; border-radius:5px; padding:15px;" onclick="myAddress()">Checkout</button></td></tr>`
                                    return table;
                                }
                        }
                        function myOrder() {
                          let uid = sessionStorage.getItem("user_id");
                                const url='http://localhost:3000/orders';
                                axios.get(url)
                                .then(resp => {
                                    data = resp.data;
                                    tablebody.innerHTML = createTable(data);
                                })
                                .catch(error => {
                                    console.log(error);
                                });   
                                
                                function createTable(data) {

                                    let table ='<tr><td><h2>My Orders</h2></td></tr><br>'
                                    
                                    data.map(e => {
                                      if((parseInt(uid))==(parseInt(e.uid))){
                                        table += `<div style="margin:20px; border-radius:10px">
                                                    <tr>
                                                    <td style="width:30%; padding-top:10px; padding-bottom:10px; background-color:#669999">
                                                        <center><img src="${e.img}" width="150" height="200"/>
                                                        </center>
                                                    </td>
                                                    <td style="background-color:#669999">
                                                        <center>${e.name}
                                                        </center>
                                                    </td>
                                                    <td style="background-color:#669999">
                                                        <center>${e.price}
                                                        </center>
                                                    </td>
                                                    <td style="background-color:#669999">
                                                        <center>${e.description}
                                                        </center>
                                                    </td>
                                                    <td style="background-color:#669999; padding-right:20px">
                                                        <center>Shipping Details<br><br>${e.addr}<br>${e.city}
                                                        <br>${e.state}<br>${e.pin}</center>
                                                    </td>
                                                  </tr></div>`
                                      }
                                    })
                                    return table;
                                }
                        }

                        function remove(did){
      
                        }

                    
                        function done() {
                          let uid = sessionStorage.getItem("user_id");
                          const url='http://localhost:3000/cart?uid='+uid;
                         

                          axios.get(url)
                            .then(resp => {
                                data = resp.data;
                                data.forEach(e => {
                                
                                    var nid = new Date().getTime();
                                    let id = e.id;
                                    let pid = e.pid;
                                    let sid = e.sid;
                                    let name = e.name;
                                    let description = e.description;
                                    let price = e.price;
                                    let img=e.img;
                                    let uid = sessionStorage.getItem("user_id");
                                    let addr = sessionStorage.getItem("user_village");
                                    let city = sessionStorage.getItem("user_district");
                                    let state = sessionStorage.getItem("user_state");
                                    let pin = sessionStorage.getItem("user_pin");
                                    let status = "Shipped";
                                    const insertUrl='http://localhost:3000/orders';
                                  
                                    axios.post(insertUrl, {
                                      id:nid,
                                      pid:pid,
                                      uid: uid,
                                      sid: sid,
                                      name:name,
                                      description:description,
                                      price:price,
                                      status:status,
                                      img:img,
                                      addr:addr,
                                      city:city,
                                      state:state,
                                      pin:pin 

                              }).then(resp => {
                          //  alert("Item is added to cart !");
                            // window.location.href = "userCart.html";

                          console.log(resp.data);
                            }).catch(error => {
                                console.log(error);
                            });


                          });
                                
                          window.location = "orderplaced.html";    
                            })
                            .catch(error => {
                                console.log(error);
                            });

                            
                        }

                        
                    </script> 
            </div>
        </div>
    </div>

<br><br><br><br>

   <!-- Footer -->
<div class="footer">

  <!-- Footer Elements -->
  <div class="container">

    <!-- Call to action -->
    <ul class="list-unstyled list-inline text-center py-2">
      <li class="list-inline-item">
        <h5 class="mb-1">Register for free</h5>
      </li>
      <li class="list-inline-item">
        <a href="signup.html" class="btn btn-primary">Sign up!</a><br>
      </li>
    </ul>
    <!-- Call to action -->

  </div>
  <!-- Footer Elements -->

  <!-- Copyright -->
  <div class="footer">© 2020 Copyright:
    <a href="home.html">eShopper.com</a>
  </div>
  <!-- Copyright -->

</div>
<!-- Footer -->
     </div>
</body>  
 
</html>