<html>
    <head>
       <!-- <script src="jquery.min.js"></script> -->
     <script src="bootstrap.min.js"></script>
     <link href="bootstrap.min.css" rel="stylesheet">
     <link rel="stylesheet" href="css/login.css">

     <script src="https://apis.google.com/js/platform.js" async defer></script>
  
    
    
     <meta name="google-signin-scope" content="profile email">

     <meta name="google-signin-client_id" content="870656439910-hoois480mb1g1a67bt7aj0i3jqvi0bp7.apps.googleusercontent.com">

     <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.2/axios.js"></script>
  </head>

  <body>
    <nav class="navbar navbar-inverse" style="background-color: #212529">
  <div class="container-fluid">
    <div class="navbar-header">
      <a  style="color: yellow;"  class="navbar-brand" href="#">eShopper</a>
    </div>
    <ul class="nav navbar-nav">
      <li><a href="home.html">Home</a></li>
     
        
    </ul>
    <ul class="nav navbar-nav navbar-right">
       <li><a href="aboutus.html">About us</a></li>
       <script>

        if(sessionStorage.getItem("user_role")!=null){
                  document.write(' <li><a href="logout.html">Logout</a></li> ');
                }
                else{
                  document.write(' <li><a href="signup.html">Sign Up</a></li><li><a href="login.html">Login</a></li>');
        
                }
              </script>
        
    </ul> 
  </div>
</nav>

<div class="row1">
<div class="row2">
  <div class="col1"></div>
  <div class="col2">

    <center><h1 class="h1">Please Login!</h1></center>
   

    <form>
    <div class="form-group row">
      <label class="col-sm-2 col-form-label"> E-mail</label>
      <div class="col-sm-10">
        <input class="form-control" id="userid" name="userid" type="text" placeholder="Enter-Your-Name"  required><br>
      </div> 
      </div> 
      
      <div class="form-group row">
        <label class="col-sm-2 col-form-label">Password</label>
        <div class="col-sm-10">
          <input class="form-control" type="password" id="pwd" name="pwd" placeholder="Enter-Your-Password" required><br>
        </div> 
        </div>   
   
    <!-- <input type="checkbox" checked="checked" name="remember"> Remember me <br> -->
    <button id="submitbtn" name="submitbtn" type="submit">Login</button></form>
   
      
    <center> <h4> or</h4></center>
     <center> <div class="g-signin2" data-onsuccess="onSignIn" id="myP"></div></center>
<img id="myImg" ><br>
<p id="name"></p> 
<div id="status"></div>
</div>
</div>

</div>


<script>

  const url='http://localhost:3000/users'

submitbtn.onclick = function (e) {

e.preventDefault(); 
// alert("sdfsdfsdfs");
getuser();


// alert(sessionStorage.getItem("user_role"));
  

// window.location.href = "home.html";
     
  };

function getuser(){

axios.get(url).then(resp => {
    data = resp.data;
    var array = getDataById(data);
    if(array.length<2){
      alert("You have not registered");
     window.location.href = "login.html";
    }
 
    // '<%Session["user_id"] = "' + array[0] + '"; %>';
    // '<%Session["UserName"] = "' + array[1] + '"; %>';
    // '<%Session["user_email"] = "' + array[3] + '"; %>';
    // '<%Session["user_role"] = "' + array[3] + '"; %>';
    //  alert('<%=Session["UserName"] %>');
    // sessionStorage.clear();
    sessionStorage.clear();
    // sessionStorage.removeItem("user_id");
    // sessionStorage.removeItem("user_name");
    // sessionStorage.removeItem("user_email");
    // sessionStorage.removeItem("user_role");

    sessionStorage.setItem("user_id",array[0]);
    sessionStorage.setItem("user_name",array[1]);
    sessionStorage.setItem("user_email",array[2]);
    sessionStorage.setItem("user_role",array[3]);
    sessionStorage.setItem("user_village",array[4]);
    sessionStorage.setItem("user_district",array[5]);
    sessionStorage.setItem("user_state",array[6]);
    sessionStorage.setItem("user_pin",array[7]);
   
  //  alert(sessionStorage.getItem("user_role"));
   window.location.href = "home.html";
})
.catch(error => {
    console.log(error);
});   


    function getDataById(data) {

var elements;

data.map(e => {
   
if(e.email == userid.value){

   if(e.password!=pwd.value){
     alert("Wrong Password!");
     window.location.href = "login.html";
   }
    
    elements = [`${e.id}`, `${e.name}`, `${e.email}`, `${e.role}`, `${e.Village}`, `${e.District}`, `${e.State}`, `${e.Pin}`];

}

})
return elements;
}
}


      function onSignIn(googleUser) {
      // window.location.href='success.jsp';

     
      
          var profile = googleUser.getBasicProfile();
          var imagurl=profile.getImageUrl();
          var name=profile.getName();
          var email=profile.getEmail();
          document.getElementById("myImg").src = imagurl;
          document.getElementById("name").innerHTML = name;
                   document.getElementById("myP").style.visibility = "hidden";
                  
                   sessionStorage.clear();
                   var nid = new Date().getTime();
                   sessionStorage.setItem("user_id",nid);
    sessionStorage.setItem("user_name",name);
    sessionStorage.setItem("user_email",email);
    sessionStorage.setItem("user_role","Buyer");
   
          document.getElementById("status").innerHTML = 'Welcome '+name+'!<a href=home.html?email=/>Continue with Google login</a></p>'

           
           
       }
      
      
      function myFunction() {
        gapi.auth2.getAuthInstance().disconnect();
          location.reload();
      }
 
       </script>


<!-- <button onclick="myFunction()">Signout</button> -->

<!-- Footer -->
<div class="footer">

  <!-- Footer Elements -->
  <div class="container">

    <!-- Call to action -->
    <ul class="list-unstyled list-inline text-center py-2">
      <li class="list-inline-item">
        <h5 class="mb-1">Register for free</h5>
      </li>
      <li class="list-inline-item">
        <a href="signup.html" class="btn btn-primary">Sign up!</a><br>
      </li>
    </ul>
    <!-- Call to action -->

  </div>
  <!-- Footer Elements -->

  <!-- Copyright -->
  <div class="footer">Â© 2020 Copyright:
    <a href="home.html">eShopper.com</a>
  </div>
  <!-- Copyright -->

</div>
<!-- Footer -->
     </div>
  </body>
  </html>