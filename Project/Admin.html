<html>
    <head>
       <script src="jquery.min.js"></script>
	   <script src="bootstrap.min.js"></script>
	   <link href="bootstrap.min.css" rel="stylesheet">
	   <link rel="stylesheet" href="css/admin.css">
     <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.2/axios.js"></script>
	</head>

  <body class="body">
    <nav class="navbar navbar-inverse"  style="background-color: #212529">
  <div class="container-fluid">
    <div class="navbar-header">
      <a style="color: yellow;"  class="navbar-brand" href="#">eShopper</a>
    </div>
    <ul class="nav navbar-nav">
      <li><a href="home.html">Home</a></li>
      <li><a href="Admin.html">Manage Requests</a></li>

      <li><a href="viewSeller.html">View Seller</a></li>
       <li><a href="viewUser.html">View User</a></li>
    </ul>
     <ul class="nav navbar-nav navbar-right">
       <li><a href="aboutus.html">About us</a></li>
       <script>

        if(sessionStorage.getItem("user_role")!=null){
                  document.write(' <li><a href="logout.html">Logout</a></li> ');
                }
                else{
                  document.write(' <li><a href="signup.html">Sign Up</a></li><li><a href="login.html">Login</a></li>');
        
                }
              </script>
        
    </ul> 
  </div>
</nav>

<div class="row1">
  <div class="row2">
    <div class="col1"></div>
    <div class="col2">

  <center><h2 class="h2">Seller Requests!</h2>
  <p class="p">Hey! Admin many permissions are pending...</p></center>          
  <table class="table table-hover">
    <thead>
      <tr class="info">
        <th>Name</th>
        <th>Email</th>
        <th>Bussiness Title</th>
        <th>Bussiness Description</th>
        <th>Permissions</th>
      </tr>
    </thead>
    <tbody id="tablebody">
     
    </tbody>
  </table>
  <script>
    const url='http://localhost:3000/sellers';

    axios.get(url)
    .then(resp => {
        data = resp.data;
          tablebody.innerHTML = createTable(data);
    })
    .catch(error => {
        console.log(error);
    });   
    
    function createTable(data) {

let table =''

data.map(e => {
  table += `<tr><td>${e.name}</td> <td>${e.email}</td> <td>${e.title}</td> <td>${e.description}</td> </td><td><button class="btn btn-success" id="addSeller" onclick=addSeller(${e.id})>Allow</button><button class="btn btn-danger"  id="deleteSeller" onclick=deleteSeller(${e.id})>Deny</button></td></tr>`
})
return table;
}

//add on clicking allow
function addSeller(id){
  const url='http://localhost:3000/sellers?id='+id;
 

  axios.get(url)
    .then(resp => {
        data = resp.data;
        data.forEach(e => {
            var nid = new Date().getUTCMilliseconds();
            let name = e.name;
            let email = e.email;
            let title = e.title;
            let description = e.description;

            const insertUrl='http://localhost:3000/viewSeller';
            axios.post(insertUrl, {
            id:nid,
            name:e.name,
            email:e.email,
            title:e.title,
            description:e.description
      }).then(resp => {
    alert("Seller is confirmed !");
    window.location.href = "viewSeller.html";

  console.log(resp.data);
    }).catch(error => {
        console.log(error);
    });


  });
        
         
    })
    .catch(error => {
        console.log(error);
    });
}

//function delete Seller
function deleteSeller(id){
  const url='http://localhost:3000/sellers?='+id;

            axios.delete(
                'http://localhost:3000/sellers?='+id,{
                	 id: e.id,
                     name: e.name,
                     email: e.email,
                     title: e.title,
                     description: e.description
                }
             ).then(resp => {
    alert("Seller Request is deleted !");
    window.location.href = "admin.html";

  console.log(resp.data);
    }).catch(error => {
        console.log(error);
    });       
     
}

</script>

</div>

</div>
</div>

<div class="row3">
<!-- Footer -->
<div class="footer">

  <!-- Footer Elements -->
  <div class="container">

    <!-- Call to action -->
    <ul class="list-unstyled list-inline text-center py-2">
      <li class="list-inline-item">
        <h5 class="mb-1">Register for free</h5>
      </li>
      <li class="list-inline-item">
        <a href="signup.html" class="btn btn-primary">Sign up!</a><br>
      </li>
    </ul>
    <!-- Call to action -->

  </div>
  <!-- Footer Elements -->

  <!-- Copyright -->
  <div class="footer">Â© 2020 Copyright:
    <a href="https://shopper.com/">eShopper.com</a>
  </div>
  <!-- Copyright -->

</div>
<!-- Footer -->
</div>
    
     </div>
  </body>
</html>